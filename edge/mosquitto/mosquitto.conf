# ═══════════════════════════════════════════════════════════════
# MicroLink MCS — Mosquitto Broker Configuration
# Local edge broker — all adapters publish here.
# Orchestrator forwards messages to cloud broker.
# ═══════════════════════════════════════════════════════════════

# ─── Listeners ────────────────────────────────────────────────
listener 1883 0.0.0.0
protocol mqtt
allow_anonymous true    # Internal-only network; auth via Docker network isolation

# ─── Persistence ──────────────────────────────────────────────
persistence true
persistence_location /mosquitto/data/
autosave_interval 300   # Save retained messages every 5 min

# ─── Retained messages ────────────────────────────────────────
# Telemetry uses retain=true so new subscribers get last known values
retain_available true

# ─── Message limits ───────────────────────────────────────────
max_inflight_messages 200
max_queued_messages 10000
message_size_limit 8192   # 8KB — our messages are ~120 bytes avg

# ─── Logging ──────────────────────────────────────────────────
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
# log_type information   # Enable for debugging only — very verbose
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ─── Connection tuning ────────────────────────────────────────
max_keepalive 120
